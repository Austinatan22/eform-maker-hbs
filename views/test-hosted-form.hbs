<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hosted Form Test Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container my-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <h1 class="text-center mb-4">Hosted Form Testing</h1>

                <div class="alert alert-info">
                    <h5>ðŸ§ª Testing Hosted Forms</h5>
                    <p>This page demonstrates how forms can be hosted and embedded on external websites.
                        The form below is rendered using the same template that would be used on client sites.</p>
                </div>

                {{#if forms}}
                <div class="row">
                    {{#each forms}}
                    <div class="col-md-6 mb-4">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">{{this.title}}</h5>
                                <span class="badge bg-secondary">{{this.category}}</span>
                            </div>
                            <div class="card-body">
                                <p class="text-muted">Form ID: <code>{{this.id}}</code></p>
                                <p class="text-muted">Fields: {{this.fieldCount}}</p>

                                <div class="d-grid gap-2">
                                    <a href="/f/{{this.id}}" class="btn btn-primary" target="_blank">
                                        ðŸ”— View Hosted Form
                                    </a>
                                    <a href="/f/{{this.id}}" class="btn btn-outline-secondary">
                                        ðŸ“‹ Test in Same Tab
                                    </a>
                                </div>

                                <hr>
                                <h6>Embed Code:</h6>
                                <textarea class="form-control" rows="3"
                                    readonly>&lt;iframe src="{{baseUrl}}/f/{{this.id}}" width="100%" height="600" frameborder="0"&gt;&lt;/iframe&gt;</textarea>
                            </div>
                        </div>
                    </div>
                    {{/each}}
                </div>
                {{else}}
                <div class="alert alert-warning">
                    <h5>No Forms Found</h5>
                    <p>No forms exist yet. Create a form using the form builder first, then return to this page to test
                        hosting.</p>
                    <a href="/forms" class="btn btn-primary">Go to Form Builder</a>
                </div>
                {{/if}}

                <div class="mt-5">
                    <h3>Create Sample Test Form</h3>
                    <p>Click the button below to create a sample form for testing:</p>
                    <button id="createSampleForm" class="btn btn-success">Create Sample Contact Form</button>
                </div>

                {{#if forms}}
                <div class="mt-5">
                    <h3>Embedded Example</h3>
                    <p>Here's how the first form would look when embedded:</p>
                    <div class="border rounded p-3" style="background-color: #f8f9fa;">
                        <iframe src="/f/{{forms.0.id}}" width="100%" height="600" frameborder="0"></iframe>
                    </div>
                </div>
                {{/if}}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('createSampleForm')?.addEventListener('click', async () => {
            const btn = document.getElementById('createSampleForm');
            btn.disabled = true;
            btn.textContent = 'Creating...';

            try {
                const headers = {
                    'Content-Type': 'application/json'
                };
                { { #if csrfToken } }
                headers['CSRF-Token'] = '{{csrfToken}}';
                { {/if } }

                const response = await fetch('/api/forms', {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify({
                        title: 'Sample Contact Form',
                        category: 'survey',
                        fields: [
                            {
                                id: 'name',
                                type: 'name',
                                label: 'Full Name',
                                name: 'fullName',
                                placeholder: 'Enter your full name',
                                required: true
                            },
                            {
                                id: 'email',
                                type: 'email',
                                label: 'Email Address',
                                name: 'email',
                                placeholder: 'your@email.com',
                                required: true
                            },
                            {
                                id: 'phone',
                                type: 'phone',
                                label: 'Phone Number',
                                name: 'phone',
                                placeholder: 'Your phone number'
                            },
                            {
                                id: 'subject',
                                type: 'dropdown',
                                label: 'Subject',
                                name: 'subject',
                                options: 'General Inquiry,Support,Sales,Other',
                                required: true
                            },
                            {
                                id: 'message',
                                type: 'paragraph',
                                label: 'Message',
                                name: 'message',
                                placeholder: 'Tell us how we can help you...',
                                required: true
                            }
                        ]
                    })
                });

                if (response.ok) {
                    location.reload();
                } else {
                    const error = await response.json();
                    alert('Error: ' + (error.error || 'Failed to create form'));
                }
            } catch (err) {
                alert('Error: ' + err.message);
            } finally {
                btn.disabled = false;
                btn.textContent = 'Create Sample Contact Form';
            }
        });
    </script>
</body>

</html>